<html>
<head>
<meta http-equiv="Content-Type" content="text/html;utf-8" />
<link rel="stylesheet" type="text/css" href="../styles/default.css" />
<script src="../../../../boot.js"></script>
<body>
<h1>运行时脚本装载顺序如下</h1>
<ul>
<script>
/*
 * for runtime import
 */

var data = decodeURIComponent(ocation.search).split('%');
var packages = data[0].split(',');
var imports = data[1].split(',');
 
var runtimeExportResult = [];
var runtimeExportFlag ={};
var prototypeLoader;

function updatePackage(packageObject){
    if(prototypeLoader == null){
        prototypeLoader = packageObject.loadScript;
    }
    if(packageObject.loadScript == prototypeLoader){
        packageObject.loadScript = function(fileName){
            var path = this.scriptBase.substr($JSI.scriptBase.length) + fileName;
            prototypeLoader.apply(this,arguments);
            if(!runtimeExportFlag[path]){
                runtimeExportResult.push(path);
                runtimeExportFlag[path] = true;
            }
        }
    }
}
for(var i=0; i<packages; i++) {
    updatePackage($import(packages[i]+':'));
}
for(var i=0; i<imports.length; i++) {
    $import(imports[i]);
}
for(var i=0; i<runtimeExportResult.length; i++) {
    document.write("<li>");
    document.write(runtimeExportResult[i]);
    document.write("</li>");
}
</script>
</ul>
</body>
</html>
