<html>
<script type="text/javascript">
document.write("<script defer='defer' id='defer'>\
    alert('def:'+document.getElementById('last').innerHTML)\
  <\/script>");
</script>
  <script>
   alert("not def0")
</script>
  <script>
  
  alert("not def" + document.readyState+document.getElementById('last'))
  alert('def:'+document.getElementById('last').innerHTML)
    var defer = document.getElementById('defer');
    var result1=[document.readyState];
    var result2=[document.documentElement.readyState];
    var result3=[];
    var result4=[defer.readyState];
    document.attachEvent('onreadystatechange',function(){
      result1.push(document.readyState);
      result2.push(document.documentElement.readyState);
    });
    document.documentElement.attachEvent('onreadystatechange',function(){
      result2.push(document.documentElement.readyState);
    });
    defer.attachEvent('onreadystatechange',function(){
      result4.push(defer.readyState);
    });
    function showResult(){
      alert("documentStates:"+result1.join(',')+
       "\ndocumentElementStates:"+result2.join(',')+
       "\nimageStates:"+result3.join(',')+
       "\ndefer:"+result4.join(',')
       );
       
    }
  </script>
  <head>
    <title>Test DomContentLoad</title>
    <script>
  function addDOMLoadListener(listener){
    function statechanged(){
      if(/loaded|interactive|complete/.test(document.readyState)||
        'interactive' == document.readyState
         ){
          //var s = (document.readyState + document.documentElement.readyState)
          alert(document.documentElement.readyState)
          listener();
          //alert("state:"+s)
          //element.detachEvent('onreadystatechange',statechanged)
      }
    }
    document.attachEvent('onreadystatechange',statechanged);
    result1.push(document.readyState);
  }
    </script>
  </head>

  <script>
    addDOMLoadListener(function(){alert('dom loaded')});
alert("before body" + document.readyState)
 //alert(document.body.readyState);
  </script>
  <body topmargin="0" bottommargin="0" onload="showResult()">
<script>
alert("in body" + document.readyState)
 //alert(document.body.readyState);
</script>
<div style="display:none">
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
</div>
  <script>
  result1.push( document.readyState)
document.write("<input id='img' type=image src=http://www.brothercake.com/scripts/iotbs/iotbs.bmp?id1="+new Date().getTime()+">");
  </script>
  <script>
  result1.push( document.readyState)
   var img = document.getElementById('img');
   img.attachEvent('onreadystatechange',function(){
      result3.push(img.readyState);
    });
  </script>
  <div style="display: none">
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
</div>
<div style="background: red;">
<p>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</p>
<p>##########################################</p>
<p>##########################################</p>
<p>##########################################</p>
<p>##########################################</p>
<p>##########################################</p>
<p>##########################################</p>
</div>
  <div>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
  <span>1233333333333333333333333333333333333333333333333333333333333333333333333333333333</span>
</div>
  </body>
  <div id = 'last'>xxx</div>
</html>
