<?xml version="1.0" encoding="GBK"?>
<project name="JSI" default="build" basedir="../">
	<property name="version" value="2.5-preview-2008-04-30" />
	<taskdef resource="jst-task.properties" classpath="build/lib/JSA.jar" />
	<target name="init">
		<delete dir="build/temp">
		</delete>
		<mkdir dir="build/temp/scripts" />
		<mkdir dir="build/dest" />
	</target>
	<target name="jar">
		<jar destfile="build/dest/JSI.jar">
			<fileset dir="web/WEB-INF/classes">
				<include name="**/*.*" />
			</fileset>
			<fileset dir="src/main">
				<include name="**/*.java" />
			</fileset>
		</jar>
	</target>
	<target name="JSA">
		<!--  classname="org.jside.jsi.tools.web.SimpleWebServer"-->
		<java classname="org.jside.jsi.tools.export.ExportorAction">
			<classpath>
				<path location="../JST/classes"></path>
				<fileset dir="../JST/lib">
					<include name="**/*.jar" />
				</fileset>
			</classpath>
			<arg value="-scriptBase" />
			<arg value="${basedir}/web/scripts" />
			<arg value="-outputBoot" />
			<arg value="${basedir}/build/dest/boot.js" />
			<arg value="-bootCached" />
			<arg value="example.*" />
			<arg value="-outputExported" />
			<arg value="${basedir}/build/dest/exported.js" />
			<arg value="-outputXML" />
			<arg value="${basedir}/build/dest/exported.xml"/>
			<arg value="-outputJAR" />
			<arg value="${basedir}/build/dest/exported.jar" />
			<arg value="-ascii" />
			<arg value="false" />
			<arg value="example.*" />
			<arg value="org.xidea.jsidoc.*" />
		</java>
	</target>
	<target name="buildExample" depends="jar">
		<war destfile="build/dest/JSI-empty-${version}.war" webxml="web/WEB-INF/web.xml">
			<zipfileset file="JSI.jar" dir="build/dest" prefix="WEB-INF/lib/" />
			<zipfileset dir="web" prefix="scripts">
				<exclude name="*.*" />
				<exclude name="*/**" />
			</zipfileset>
			<zipfileset dir="web">
				<include name="WEB-INF/lib/**/*.*" />
			</zipfileset>
		</war>
		<war destfile="build/dest/JSI-example-${version}.war" webxml="web/WEB-INF/web.xml" description="http://localhost/JSI-example-${version}/scripts/jsidoc">
			<zipfileset file="JSI.jar" dir="build/dest" prefix="WEB-INF/lib/" />
			<zipfileset dir="web">
				<include name="scripts/example/**/*.*" />
				<include name="WEB-INF/lib/**/*.*" />
			</zipfileset>
		</war>
	</target>
	<target name="ftp">
		<ftp password="jindw@163.com" server="upload.sourceforge.net" userid="anonymous" action="put"  remotedir="/incoming">
			<fileset file="build/dest/">
                <include name="*${version}.war"/>
                <include name="JSI.jar"/>
			</fileset>
		</ftp>
	</target>
	<target name="packageDoc" depends="init">
		<zip destfile="build/dest/JSI-doc-${version}.zip">
			<zipfileset dir="web/doc">
				<include name="**/*.*" />
			</zipfileset>
		</zip>
	</target>
	<target name="buildJSIDoc" depends="init">
		<delete file="build/dest/JSI-JSIDoc-${version}.zip">
		</delete>
		<java classpath="web/WEB-INF/classes/" classname="org.xidea.jsi.doc.SimpleCacheBuilder">
			<arg value="${basedir}/web/scripts" />
			<arg value="${basedir}/build/temp/" />
		</java>
		<zip destfile="build/dest/JSI-JSIDoc-${version}.zip" compress="true">
			<zipfileset dir="web/scripts">
				<include name="**/*.*" />
				<exclude name="**/*.db" />
				<exclude name="*/**/*.js" />
				<exclude name="*/**/*.xhtml" />
				<exclude name="*/**/*test*.html" />
				<exclude name="*/**/root-frame.html" />
			</zipfileset>
			<zipfileset dir="web/scripts/org/xidea/jsidoc/">
				<include name="root-frame.html" />
			</zipfileset>
			<zipfileset dir="build/temp/">
				<include name="jsidoc-source.js" />
			</zipfileset>
		</zip>
	</target>
	<target name="build" depends="compress">
		<delete file="build/dest/JSI-${version}.tar">
		</delete>
		<tar destfile="build/dest/JSI-${version}.tar" compression="gzip">
			<tarfileset dir="build/temp">
				<include name="scripts/**/*.*" />
				<exclude name="**/*.db" />
			</tarfileset>
			<tarfileset dir="web">
				<exclude name="scripts/**/*.*" />
				<exclude name="WEB-INF/**/*.*" />
				<exclude name="**/*.db" />
				<include name="**/*.*" />
			</tarfileset>
		</tar>
		<zip destfile="build/dest/JSI-${version}.zip" compress="true">
			<zipfileset dir="build/temp">
				<include name="scripts/**/*.*" />
				<exclude name="**/*.db" />
			</zipfileset>
			<zipfileset dir="web">
				<exclude name="scripts/**/*.*" />
				<exclude name="WEB-INF/**/*.*" />
				<exclude name="**/*.db" />
				<include name="**/*.*" />
			</zipfileset>
		</zip>
	</target>
	<target name="buildFull">
		<zip destfile="build/dest/JSI-full-${version}.zip">
			<zipfileset src="build/dest/JSI-${version}.zip" />
			<zipfileset src="build/lib/JSI-thirdparty-2007-05-09.zip" />
		</zip>
	</target>
	<target name="compress" depends="init">
		<jsicompile syntaxcompression="false" destDir="build/temp/scripts" charset="utf-8">
			<fileset dir="web/scripts">
				<include name="*/**/*.*" />
				<include name="*.*" />
				<exclude name="*rhino*" />
				<exclude name="preload/**" />
			</fileset>
			<preloadgroup path="code-decorator.js">
				<fileset dir="web/scripts">
					<include name='js/io/__$package.js' />
					<include name='js/io/request.js' />
					<include name='js/io/writer.js' />
					<include name='js/xml/__$package.js' />
					<include name='js/xml/template.js' />
					<include name='js/xml/tag.js' />
					<include name='js/util/__$package.js' />
					<include name='js/util/collections.js' />
					<include name='org/xidea/syntax/__$package.js' />
					<include name='org/xidea/syntax/syntax-parser.js' />
					<include name='org/xidea/decorator/__$package.js' />
					<include name='org/xidea/decorator/code.js' />
				</fileset>
			</preloadgroup>
		</jsicompile>
	</target>
	<target name="compressAllInOne">
		<delete dir="build/temp/scripts2" />
		<mkdir dir="build/temp/scripts2" />
		<jsicompile syntaxcompression="false" textcompression="false" destDir="build/temp/scripts2" rebuildboot="true" charset="utf-8">
			<fileset dir="web/scripts">
				<include name="*/**/*.*" />
				<include name="*.*" />
				<exclude name="*rhino*" />
				<exclude name="org/**/*.*" />
				<exclude name="preload/**" />
			</fileset>
			<preloadgroup>
				<fileset dir="web/scripts">
					<include name="*/**/*.*" />
					<include name="*.*" />
					<exclude name="*rhino*" />
					<exclude name="org/**/*.*" />
					<exclude name="preload/**" />
				</fileset>
			</preloadgroup>
		</jsicompile>
	</target>

</project>